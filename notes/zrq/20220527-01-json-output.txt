#
# <meta:header>
#   <meta:licence>
#     Copyright (c) 2022, ROE (http://www.roe.ac.uk/)
#
#     This information is free software: you can redistribute it and/or modify
#     it under the terms of the GNU General Public License as published by
#     the Free Software Foundation, either version 3 of the License, or
#     (at your option) any later version.
#
#     This information is distributed in the hope that it will be useful,
#     but WITHOUT ANY WARRANTY; without even the implied warranty of
#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#     GNU General Public License for more details.
#
#     You should have received a copy of the GNU General Public License
#     along with this program.  If not, see <http://www.gnu.org/licenses/>.
#   </meta:licence>
# </meta:header>
#
#zrq-notes-time
#zrq-notes-indent
#zrq-notes-crypto
#zrq-notes-ansible
#zrq-notes-osformat
#zrq-notes-zeppelin
#

    Target:

        Modify the rest tools to output JSON

    Result:

        Success.
        testall function outputs valid JSON.


# -----------------------------------------------------
# Login to Zeppelin as the test user.
#[root@ansibler]

    source '/deployments/zeppelin/bin/zeppelin-rest-tools.sh'

    zeplogin "${testusername:?}" "${testuserpass:?}" \
    | jq '.'

    >   {
    >     "username": "ciNg2thu",
    >     "password": "phuduuwieb7Ietho2koo4Eegaiw9ac",
    >     "response": {
    >       "status": "OK",
    >       "message": "",
    >       "body": {
    >         "principal": "ciNg2thu",
    >         "ticket": "9ee3cb6e-3e3b-45fd-be9d-29c465f0c71a",
    >         "roles": "[\"user\"]"
    >       }
    >     }
    >   }


# -----------------------------------------------------
# Clear a notebook.
#[root@ansibler]

    noteid=2H657JQT2

    source '/deployments/zeppelin/bin/zeppelin-rest-tools.sh'

    zepnbclear "${noteid}" \
    | jq '.'

    >   {
    >     "notebook": "2H657JQT2",
    >     "response": {
    >       "status": "OK",
    >       "message": ""
    >     }
    >   }


# -----------------------------------------------------
# Get a notebook status.
#[root@ansibler]

    noteid=2H657JQT2

    source '/deployments/zeppelin/bin/zeppelin-rest-tools.sh'

    zepnbstatus "${noteid}" \
    | jq '.'

    >   {
    >     "notebook": "2H657JQT2",
    >     "response": {
    >       "status": "OK",
    >       "message": "",
    >       "body": {
    >         "paragraphs": [],
    >         "name": "3. Source counts over the sky",
    >         "id": "2H657JQT2",
    >         "defaultInterpreterGroup": "spark",
    >         "version": "0.10.0",
    >         "noteParams": {},
    >         "noteForms": {},
    >         "angularObjects": {},
    >         "config": {
    >           "personalizedMode": "false",
    >           "looknfeel": "default",
    >           "isZeppelinNotebookCronEnable": false
    >         },
    >         "info": {},
    >         "path": "/Users/ciNg2thu/3. Source counts over the sky"
    >       }
    >     }
    >   }


# -----------------------------------------------------
# Execute a notebook.
#[root@ansibler]

    noteid=2H657JQT2

    source '/deployments/zeppelin/bin/zeppelin-rest-tools.sh'

    zepnbexecstep "${noteid}"

    zepnbexecstep "${noteid}" \
    | jq '.'

    >   {
    >     "noteid": "2H657JQT2",
    >     "paragraphs": [
    >       {
    >         "noteid": "2H657JQT2",
    >         "paraid": "20210507-084613_357121151",
    >         "title": "null",
    >         "execute": {
    >           "status": "OK",
    >           "body": {
    >             "code": "SUCCESS"
    >           }
    >         },
    >         "duration": "0:0:0"
    >       },
    >       {
    >         "noteid": "2H657JQT2",
    >         "paraid": "20200826-105718_1698521515",
    >         "title": "Set the resolution level and define the query",
    >         "execute": {
    >           "status": "OK",
    >           "body": {
    >             "code": "SUCCESS"
    >           }
    >         },
    >         "duration": "0:0:0"
    >       },
    >       {
    >         "noteid": "2H657JQT2",
    >         "paraid": "20200826-110030_2095441495",
    >         "title": "Plot up the results",
    >         "execute": {
    >           "status": "OK",
    >           "body": {
    >             "code": "SUCCESS"
    >           }
    >         },
    >         "duration": "0:0:25"
    >       },
    >       {
    >         "noteid": "2H657JQT2",
    >         "paraid": "20210507-091244_670006530",
    >         "title": "Further reading and resources",
    >         "execute": {
    >           "status": "OK",
    >           "body": {
    >             "code": "SUCCESS"
    >           }
    >         },
    >         "duration": "0:0:1"
    >       },
    >       {
    >         "noteid": "2H657JQT2",
    >         "paraid": "paragraph_1648610499944_1376690736",
    >         "title": "null",
    >         "execute": {
    >           "status": "OK",
    >           "body": {
    >             "code": "SUCCESS"
    >           }
    >         },
    >         "duration": "0:0:0"
    >       }
    >     ],
    >     "duration": "0:0:27"
    >   }

# -----------------------------------------------------
# -----------------------------------------------------
# Putting it all together
#[root@ansibler]

    source '/deployments/zeppelin/bin/zeppelin-rest-tools.sh'

    testall "${testusername}" "${testuserpass}" \
    | tee /tmp/testall.json

    jq '.' /tmp/testall.json


    >   ....
    >   ....

