#
# <meta:header>
#   <meta:licence>
#     Copyright (c) 2022, ROE (http://www.roe.ac.uk/)
#
#     This information is free software: you can redistribute it and/or modify
#     it under the terms of the GNU General Public License as published by
#     the Free Software Foundation, either version 3 of the License, or
#     (at your option) any later version.
#
#     This information is distributed in the hope that it will be useful,
#     but WITHOUT ANY WARRANTY; without even the implied warranty of
#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#     GNU General Public License for more details.
#
#     You should have received a copy of the GNU General Public License
#     along with this program.  If not, see <http://www.gnu.org/licenses/>.
#   </meta:licence>
# </meta:header>
#
#zrq-notes-time
#zrq-notes-indent
#zrq-notes-crypto
#zrq-notes-ansible
#zrq-notes-osformat
#zrq-notes-zeppelin
#


    Target:

        New deployment to include recent changes.

    Result:

        Work in progress ...


# -----------------------------------------------------
# Save notebook changes on the live system.
#[user@desktop]


    sshuser=fedora
    sshhost=live.aglais.uk

    ssh "${sshuser:?}@${sshhost:?}"

        hostname
        date

    >   iris-gaia-blue-20220309-zeppelin
    >   Tue 29 Mar 12:28:47 UTC 2022

        pushd zeppelin/notebook

            git status

    >   On branch main
    >   Your branch is ahead of 'origin/main' by 12 commits.
    >     (use "git push" to publish your local commits)
    >   
    >   Changes not staged for commit:
    >     (use "git add/rm <file>..." to update what will be committed)
    >     (use "git restore <file>..." to discard changes in working directory)
    >   	modified:   Public Examples/4. Mean proper motions over the sky_2GSNYBDWB.zpln
    >   	modified:   Public Examples/6. Working with cross-matched surveys_2GZME59KY.zpln
    >   	deleted:    Public Examples/Data holdings_2GRA39HCN.zpln
    >   	deleted:    Public Examples/Good astrometric solutions via ML Random Forrest classifier_2GQDKZ59J.zpln
    >   	deleted:    Public Examples/Mean proper motions over the sky_2GSNYBDWB.zpln
    >   	deleted:    Public Examples/Source counts over the sky_2GQ6WMH9W.zpln
    >   	deleted:    Public Examples/Tips and tricks_2GVXKC266.zpln
    >   	modified:   Users/dcr/HDBSCAN_looped_2GXT874N7.zpln
    >   	modified:   Users/dcr/White_dwarf_detection_2GRMUYN35.zpln
    >   	modified:   Users/nch/SetUp_2GP53P3PZ.zpln
    >   	modified:   Users/zrq/hello-world_2GRMZKNZY.zpln
    >   
    >   Untracked files:
    >     (use "git add <file>..." to include in what will be committed)
    >   	Public Examples/2. Data holdings_2GRA39HCN.zpln
    >   	Public Examples/9. Tips and tricks_2GVXKC266.zpln
    >   	Users/nch/privacy testing_2GZW6JPH3.zpln
    >   	tmp/


            cat > .gitignore << EOF
            tmp/*
            EOF

            git add .gitignore

            git commit -m "Added gitignore file"

    >   ....
    >   ....


            git status 'Public*'

    >   On branch main
    >   Your branch is ahead of 'origin/main' by 13 commits.
    >     (use "git push" to publish your local commits)
    >   
    >   Changes not staged for commit:
    >     (use "git add/rm <file>..." to update what will be committed)
    >     (use "git restore <file>..." to discard changes in working directory)
    >   	modified:   Public Examples/4. Mean proper motions over the sky_2GSNYBDWB.zpln
    >   	modified:   Public Examples/6. Working with cross-matched surveys_2GZME59KY.zpln
    >   	deleted:    Public Examples/Data holdings_2GRA39HCN.zpln
    >   	deleted:    Public Examples/Good astrometric solutions via ML Random Forrest classifier_2GQDKZ59J.zpln
    >   	deleted:    Public Examples/Mean proper motions over the sky_2GSNYBDWB.zpln
    >   	deleted:    Public Examples/Source counts over the sky_2GQ6WMH9W.zpln
    >   	deleted:    Public Examples/Tips and tricks_2GVXKC266.zpln
    >   
    >   Untracked files:
    >     (use "git add <file>..." to include in what will be committed)
    >   	Public Examples/2. Data holdings_2GRA39HCN.zpln
    >   	Public Examples/9. Tips and tricks_2GVXKC266.zpln


            git add 'Public*'

            git status

    >   git status
    >   On branch main
    >   Your branch is ahead of 'origin/main' by 13 commits.
    >     (use "git push" to publish your local commits)
    >   
    >   Changes to be committed:
    >     (use "git restore --staged <file>..." to unstage)
    >   	renamed:    Public Examples/Data holdings_2GRA39HCN.zpln -> Public Examples/2. Data holdings_2GRA39HCN.zpln
    >   	modified:   Public Examples/4. Mean proper motions over the sky_2GSNYBDWB.zpln
    >   	modified:   Public Examples/6. Working with cross-matched surveys_2GZME59KY.zpln
    >   	renamed:    Public Examples/Tips and tricks_2GVXKC266.zpln -> Public Examples/9. Tips and tricks_2GVXKC266.zpln
    >   	deleted:    Public Examples/Good astrometric solutions via ML Random Forrest classifier_2GQDKZ59J.zpln
    >   	deleted:    Public Examples/Mean proper motions over the sky_2GSNYBDWB.zpln
    >   	deleted:    Public Examples/Source counts over the sky_2GQ6WMH9W.zpln
    >   
    >   Changes not staged for commit:
    >     (use "git add <file>..." to update what will be committed)
    >     (use "git restore <file>..." to discard changes in working directory)
    >   	modified:   Users/dcr/HDBSCAN_looped_2GXT874N7.zpln
    >   	modified:   Users/dcr/White_dwarf_detection_2GRMUYN35.zpln
    >   	modified:   Users/nch/SetUp_2GP53P3PZ.zpln
    >   	modified:   Users/zrq/hello-world_2GRMZKNZY.zpln
    >   
    >   Untracked files:
    >     (use "git add <file>..." to include in what will be committed)
    >   	Users/nch/privacy testing_2GZW6JPH3.zpln


            git commit -m "Added changes to Public Examples" 'Public*'

    >   [main 0550046] Added changes to Public Examples
    >    7 files changed, 217 insertions(+), 1915 deletions(-)
    >    rename Public Examples/{Data holdings_2GRA39HCN.zpln => 2. Data holdings_2GRA39HCN.zpln} (100%)
    >    rename Public Examples/{Tips and tricks_2GVXKC266.zpln => 9. Tips and tricks_2GVXKC266.zpln} (82%)
    >    delete mode 100644 Public Examples/Good astrometric solutions via ML Random Forrest classifier_2GQDKZ59J.zpln
    >    delete mode 100644 Public Examples/Mean proper motions over the sky_2GSNYBDWB.zpln
    >    delete mode 100644 Public Examples/Source counts over the sky_2GQ6WMH9W.zpln


            git status 'Users/dcr/*'

    >   ....
    >   Changes not staged for commit:
    >     (use "git add <file>..." to update what will be committed)
    >     (use "git restore <file>..." to discard changes in working directory)
    >   	modified:   Users/dcr/HDBSCAN_looped_2GXT874N7.zpln
    >   	modified:   Users/dcr/White_dwarf_detection_2GRMUYN35.zpln
    >   ....

            git add 'Users/dcr/*'

            git commit -m "Updates to Users/dcr" 'Users/dcr/*'

    >   [main 9b9aa01] Updates to Users/dcr
    >    2 files changed, 183 insertions(+), 55 deletions(-)


            git status 'Users/nch/*'

    >   On branch main
    >   Your branch is ahead of 'origin/main' by 15 commits.
    >     (use "git push" to publish your local commits)
    >   
    >   Changes not staged for commit:
    >     (use "git add <file>..." to update what will be committed)
    >     (use "git restore <file>..." to discard changes in working directory)
    >   	modified:   Users/nch/SetUp_2GP53P3PZ.zpln
    >   
    >   Untracked files:
    >     (use "git add <file>..." to include in what will be committed)
    >   	Users/nch/privacy testing_2GZW6JPH3.zpln

            git add 'Users/nch/*'

            git commit -m "Updates to Users/nch" 'Users/nch/*'

    >   [main 5ae0cfb] Updates to Users/nch
    >    2 files changed, 60 insertions(+), 29 deletions(-)
    >    create mode 100644 Users/nch/privacy testing_2GZW6JPH3.zpln


            git status 'Users/zrq/*'

    >   ....
    >   Changes not staged for commit:
    >     (use "git add <file>..." to update what will be committed)
    >     (use "git restore <file>..." to discard changes in working directory)
    >   	modified:   Users/zrq/hello-world_2GRMZKNZY.zpln
    >   ....

            git add 'Users/zrq/*'

            git commit -m "Updates to Users/zrq" 'Users/zrq/*'

    >   [main b999e6c] Updates to Users/zrq
    >    1 file changed, 17 insertions(+), 5 deletions(-)


            git status

    >   On branch main
    >   Your branch is ahead of 'origin/main' by 17 commits.
    >     (use "git push" to publish your local commits)


            git push

    >   To github.com:wfau/aglais-notebooks.git
    >    ! [rejected]        main -> main (fetch first)
    >   error: failed to push some refs to 'git@github.com:wfau/aglais-notebooks.git'
    >   hint: Updates were rejected because the remote contains work that you do
    >   hint: not have locally. This is usually caused by another repository pushing
    >   hint: to the same ref. You may want to first integrate the remote changes
    >   hint: (e.g., 'git pull ...') before pushing again.
    >   hint: See the 'Note about fast-forwards' in 'git push --help' for details.


            git pull

    >   remote: Enumerating objects: 39, done.
    >   remote: Counting objects: 100% (39/39), done.
    >   remote: Compressing objects: 100% (26/26), done.
    >   remote: Total 34 (delta 20), reused 22 (delta 8), pack-reused 0
    >   Unpacking objects: 100% (34/34), done.
    >   From github.com:wfau/aglais-notebooks
    >      188de92..b4817de  main       -> origin/main
    >   Auto-merging Public Examples/9. Tips and tricks_2GVXKC266.zpln
    >   CONFLICT (content): Merge conflict in Public Examples/9. Tips and tricks_2GVXKC266.zpln
    >   CONFLICT (rename/delete): Public Examples/Good astrometric solutions via ML Random Forrest classifier_2GQDKZ59J.zpln deleted in HEAD and renamed to Public Examples/7. Good astrometric solutions via ML Random Forrest classifier_2GQDKZ59J.zpln in b4817de52ebb7ac81e301a8a8464870692d23a24. Version b4817de52ebb7ac81e301a8a8464870692d23a24 of Public Examples/7. Good astrometric solutions via ML Random Forrest classifier_2GQDKZ59J.zpln left in tree.
    >   Auto-merging Public Examples/6. Working with cross-matched surveys_2GZME59KY.zpln
    >   CONFLICT (content): Merge conflict in Public Examples/6. Working with cross-matched surveys_2GZME59KY.zpln
    >   CONFLICT (rename/delete): Public Examples/Mean proper motions over the sky_2GSNYBDWB.zpln deleted in HEAD and renamed to Public Examples/4. Mean proper motions over the sky_2GSNYBDWB.zpln in b4817de52ebb7ac81e301a8a8464870692d23a24. Version b4817de52ebb7ac81e301a8a8464870692d23a24 of Public Examples/4. Mean proper motions over the sky_2GSNYBDWB.zpln left in tree.
    >   CONFLICT (rename/delete): Public Examples/Source counts over the sky_2GQ6WMH9W.zpln deleted in HEAD and renamed to Public Examples/3. Source counts over the sky_2GQ6WMH9W.zpln in b4817de52ebb7ac81e301a8a8464870692d23a24. Version b4817de52ebb7ac81e301a8a8464870692d23a24 of Public Examples/3. Source counts over the sky_2GQ6WMH9W.zpln left in tree.
    >   Automatic merge failed; fix conflicts and then commit the result.


    #
    # To be resolved ...
    #

        cp -a notebook notebook-bak-001

        git reset --merge

        git status

    >   On branch main
    >   Your branch and 'origin/main' have diverged,
    >   and have 17 and 8 different commits each, respectively.
    >     (use "git pull" to merge the remote branch into yours)

        cd ..

    cp -a notebook notebook-bak-002

    pushd notebook-bak-002

            git status

    >   On branch main
    >   Your branch and 'origin/main' have diverged,
    >   and have 17 and 8 different commits each, respectively.
    >     (use "git pull" to merge the remote branch into yours)

            # Pull, preferring our changes.
            # https://stackoverflow.com/a/68580000
            # https://stackoverflow.com/questions/10414769/git-pull-keeping-local-changes

            git pull -X ours

    >   Auto-merging Public Examples/9. Tips and tricks_2GVXKC266.zpln
    >   CONFLICT (rename/delete): Public Examples/Good astrometric solutions via ML Random Forrest classifier_2GQDKZ59J.zpln deleted in HEAD and renamed to Public Examples/7. Good astrometric solutions via ML Random Forrest classifier_2GQDKZ59J.zpln in b4817de52ebb7ac81e301a8a8464870692d23a24. Version b4817de52ebb7ac81e301a8a8464870692d23a24 of Public Examples/7. Good astrometric solutions via ML Random Forrest classifier_2GQDKZ59J.zpln left in tree.
    >   Auto-merging Public Examples/6. Working with cross-matched surveys_2GZME59KY.zpln
    >   CONFLICT (rename/delete): Public Examples/Mean proper motions over the sky_2GSNYBDWB.zpln deleted in HEAD and renamed to Public Examples/4. Mean proper motions over the sky_2GSNYBDWB.zpln in b4817de52ebb7ac81e301a8a8464870692d23a24. Version b4817de52ebb7ac81e301a8a8464870692d23a24 of Public Examples/4. Mean proper motions over the sky_2GSNYBDWB.zpln left in tree.
    >   CONFLICT (rename/delete): Public Examples/Source counts over the sky_2GQ6WMH9W.zpln deleted in HEAD and renamed to Public Examples/3. Source counts over the sky_2GQ6WMH9W.zpln in b4817de52ebb7ac81e301a8a8464870692d23a24. Version b4817de52ebb7ac81e301a8a8464870692d23a24 of Public Examples/3. Source counts over the sky_2GQ6WMH9W.zpln left in tree.
    >   Automatic merge failed; fix conflicts and then commit the result.


            git status

    >   On branch main
    >   Your branch and 'origin/main' have diverged,
    >   and have 17 and 8 different commits each, respectively.
    >     (use "git pull" to merge the remote branch into yours)
    >   
    >   You have unmerged paths.
    >     (fix conflicts and run "git commit")
    >     (use "git merge --abort" to abort the merge)
    >   
    >   Changes to be committed:
    >   	modified:   Public Examples/2. Data holdings_2GRA39HCN.zpln
    >   	modified:   Public Examples/6. Working with cross-matched surveys_2GZME59KY.zpln
    >   
    >   Unmerged paths:
    >     (use "git add <file>..." to mark resolution)
    >   	added by them:   Public Examples/3. Source counts over the sky_2GQ6WMH9W.zpln
    >   	added by them:   Public Examples/4. Mean proper motions over the sky_2GSNYBDWB.zpln
    >   	added by them:   Public Examples/7. Good astrometric solutions via ML Random Forrest classifier_2GQDKZ5


            ls -1 'Public Examples'

    >   '1. Start here_2GRTQZFUM.zpln'
    >   '2. Data holdings_2GRA39HCN.zpln'
    >   '3. Source counts over the sky_2GQ6WMH9W.zpln'
    >   '4. Mean proper motions over the sky_2GSNYBDWB.zpln'
    >   '6. Working with cross-matched surveys_2GZME59KY.zpln'
    >   '7. Good astrometric solutions via ML Random Forrest classifier_2GQDKZ59J.zpln'
    >   '9. Tips and tricks_2GVXKC266.zpln'

        popd

        pushd zeppelin

            notebook='1. Start here_2GRTQZFUM.zpln'
            diff "notebook/Public Examples/${notebook:?}" \
                 "notebook-bak-002/Public Examples/${notebook:?}"

    >   -

            notebook='2. Data holdings_2GRA39HCN.zpln'
            diff "notebook/Public Examples/${notebook:?}" \
                 "notebook-bak-002/Public Examples/${notebook:?}"

    >   6c6
    >   <       "user": "nch",
    >   ---
    >   >       "user": "anonymous",
    >   43a44,45
    >   >       "dateStarted": "2022-03-04T12:03:06+0000",
    >   >       "dateFinished": "2022-03-04T12:03:06+0000",
    >   46,48c48
    >   <       "$$hashKey": "object:23422",
    >   <       "dateFinished": "2022-03-04T12:03:06+0000",
    >   <       "dateStarted": "2022-03-04T12:03:06+0000"
    >   ---
    >   >       "$$hashKey": "object:38640"
    >   92c92
    >   <       "$$hashKey": "object:23423"
    >   ---
    >   >       "$$hashKey": "object:38641"
    >   136c136
    >   <       "$$hashKey": "object:23424"
    >   ---
    >   >       "$$hashKey": "object:38642"
    >   179c179
    >   <       "$$hashKey": "object:23425"
    >   ---
    >   >       "$$hashKey": "object:38643"
    >   222c222
    >   <       "$$hashKey": "object:23426"
    >   ---
    >   >       "$$hashKey": "object:38644"
    >   264c264
    >   <       "$$hashKey": "object:23427"
    >   ---
    >   >       "$$hashKey": "object:38645"
    >   308c308
    >   <       "$$hashKey": "object:23428"
    >   ---
    >   >       "$$hashKey": "object:38646"
    >   339c339
    >   <       "$$hashKey": "object:23429"
    >   ---
    >   >       "$$hashKey": "object:38647"
    >   342c342
    >   <   "name": "Data holdings",
    >   ---
    >   >   "name": "2. Data holdings",
    >   355c355
    >   <   "path": "/Public Examples/Data holdings"
    >   ---
    >   >   "path": "/Public Examples/2. Data holdings"


        tail "notebook/Public Examples/${notebook:?}"

    >     "noteForms": {},
    >     "angularObjects": {},
    >     "config": {
    >       "isZeppelinNotebookCronEnable": false,
    >       "looknfeel": "default",
    >       "personalizedMode": "false"
    >     },
    >     "info": {},
    >     "path": "/Public Examples/Data holdings"


        tail "notebook-bak-001/Public Examples/${notebook:?}"

    >     "noteForms": {},
    >     "angularObjects": {},
    >     "config": {
    >       "isZeppelinNotebookCronEnable": false,
    >       "looknfeel": "default",
    >       "personalizedMode": "false"
    >     },
    >     "info": {},
    >     "path": "/Public Examples/2. Data holdings"


        tail "notebook-bak-002/Public Examples/${notebook:?}"

    >     "noteForms": {},
    >     "angularObjects": {},
    >     "config": {
    >       "isZeppelinNotebookCronEnable": false,
    >       "looknfeel": "default",
    >       "personalizedMode": "false"
    >     },
    >     "info": {},
    >     "path": "/Public Examples/2. Data holdings"

    #
    # OK, WTF is happening here ?
    #

    On disc, the copy in 'notebook' has

        "path": "/Public Examples/Data holdings"


    When I download from the live service I get

        "path": "/Public Examples/2. Data holdings"


    The copy in GitHub main has

        "path": "/Public Examples/2. Data holdings"


    The two bak copies both have the long form.

        "path": "/Public Examples/2. Data holdings"


    So only the 'notebooks' copy on disc seems to be our of date !?


        pushd "notebook/Public Examples/" ; git diff "${notebook:?}" ; popd

            -


        pushd "notebook-bak-001/Public Examples/" ; git diff "${notebook:?}" ; popd

            -


        pushd "notebook-bak-002/Public Examples/" ; git diff "${notebook:?}" ; popd

            -


        pushd "notebook/Public Examples/" ; sed -n '/\"path\":/ p' "${notebook:?}" ; popd

            "path": "/Public Examples/Data holdings"


        pushd "notebook-bak-001/Public Examples/" ; sed -n '/\"path\":/ p' "${notebook:?}" ; popd

            "path": "/Public Examples/2. Data holdings"


        pushd "notebook-bak-002/Public Examples/" ; sed -n '/\"path\":/ p' "${notebook:?}" ; popd

            "path": "/Public Examples/2. Data holdings"



        pushd "notebook/Public Examples/" ; git log "${notebook:?}" ; popd

    >   commit 0550046fa2cf3878ab1b6606031a5d214dc6eaa4
    >   Author: aglais-admin <aglais-admin@dm92.uk>
    >   Date:   Tue Mar 29 12:53:23 2022 +0000
    >   
    >       Added changes to Public Examples


        pushd "notebook-bak-002/Public Examples/" ; git log "${notebook:?}" ; popd

    >   commit 0550046fa2cf3878ab1b6606031a5d214dc6eaa4
    >   Author: aglais-admin <aglais-admin@dm92.uk>
    >   Date:   Tue Mar 29 12:53:23 2022 +0000
    >   
    >       Added changes to Public Examples


        pushd "notebook/Public Examples/" ; git status "${notebook:?}" ; popd

    >   On branch main
    >   Your branch and 'origin/main' have diverged,
    >   and have 17 and 8 different commits each, respectively.
    >     (use "git pull" to merge the remote branch into yours)
    >   
    >   nothing to commit, working tree clean

        pushd "notebook-bak-002/Public Examples/" ; git status "${notebook:?}" ; popd

    >   On branch main
    >   Your branch and 'origin/main' have diverged,
    >   and have 17 and 8 different commits each, respectively.
    >     (use "git pull" to merge the remote branch into yours)
    >   
    >   All conflicts fixed but you are still merging.
    >     (use "git commit" to conclude merge)
    >   
    >   Changes to be committed:
    >   	modified:   2. Data holdings_2GRA39HCN.zpln


        diff "notebook/Public Examples/${notebook:?}" \
             "notebook-bak-002/Public Examples/${notebook:?}"

    >   ....
    >   ....
    >   342c342
    >   <   "name": "Data holdings",
    >   ---
    >   >   "name": "2. Data holdings",
    >   355c355
    >   <   "path": "/Public Examples/Data holdings"
    >   ---
    >   >   "path": "/Public Examples/2. Data holdings"


    #
    # What about the others ..
    #

            notebook='1. Start here_2GRTQZFUM.zpln'
            diff "notebook/Public Examples/${notebook:?}" \
                 "notebook-bak-002/Public Examples/${notebook:?}"

    >   -


            notebook='3. Source counts over the sky_2GQ6WMH9W.zpln'
            diff "notebook/Public Examples/${notebook:?}" \
                 "notebook-bak-002/Public Examples/${notebook:?}"

    >   ....
    >   .... lots
    >   ....


            notebook='4. Mean proper motions over the sky_2GSNYBDWB.zpln'
            diff "notebook/Public Examples/${notebook:?}" \
                 "notebook-bak-002/Public Examples/${notebook:?}"

    >   ....
    >   .... lots
    >   ....


            notebook='6. Working with cross-matched surveys_2GZME59KY.zpln'
            diff "notebook/Public Examples/${notebook:?}" \
                 "notebook-bak-002/Public Examples/${notebook:?}"

    >   ....
    >   ....
    >   384c384,386
    >   <     "isZeppelinNotebookCronEnable": false
    >   ---
    >   >     "isZeppelinNotebookCronEnable": false,
    >   >     "looknfeel": "default",
    >   >     "personalizedMode": "false"
    >   386c388,389
    >   <   "info": {}
    >   ---
    >   >   "info": {},
    >   >   "path": "/Public Examples/6. Working with cross-matched surveys"


            notebook='7. Good astrometric solutions via ML Random Forrest classifier_2GQDKZ59J.zpln'
            diff "notebook/Public Examples/${notebook:?}" \
                 "notebook-bak-002/Public Examples/${notebook:?}"

    >   ....
    >   .... lots
    >   ....


            notebook='9. Tips and tricks_2GVXKC266.zpln'
            diff "notebook/Public Examples/${notebook:?}" \
                 "notebook-bak-002/Public Examples/${notebook:?}"

    >   -


# -----------------------------------------------------
# -----------------------------------------------------

    Added a blank line to the last cell and triggered [commit] from the user interface.

            notebook='9. Tips and tricks_2GVXKC266.zpln'
            diff "notebook/Public Examples/${notebook:?}" \
                 "notebook-bak-002/Public Examples/${notebook:?}"

    >   966c966
    >   <       "text": "%md\n\n",
    >   ---
    >   >       "text": "%md\n",
    >   968c968
    >   <       "dateUpdated": "2022-03-30 03:08:36.656",
    >   ---
    >   >       "dateUpdated": "2022-03-03 16:29:06.000",


            pushd "notebook/Public Examples" ; git log "${notebook:?}" ; popd

    >   commit b8cb601333da6e030e86302b5b129c63ae8fb74d (HEAD -> main)
    >   Author: aglais-admin <aglais-admin@dm92.uk>
    >   Date:   Wed Mar 30 03:08:53 2022 +0000
    >   
    >       Save latest
    >   
    >   commit 0550046fa2cf3878ab1b6606031a5d214dc6eaa4
    >   Author: aglais-admin <aglais-admin@dm92.uk>
    >   Date:   Tue Mar 29 12:53:23 2022 +0000
    >   
    >       Added changes to Public Examples



            notebook='7. Good astrometric solutions via ML Random Forrest classifier_2GQDKZ59J.zpln'
            diff "notebook/Public Examples/${notebook:?}" \
                 "notebook-bak-002/Public Examples/${notebook:?}"

    >   ....
    >   ....
    >   <   }
    >   ---
    >   >   },
    >   >   "path": "/Public Examples/7. Good astrometric solutions via ML Random Forrest classifier"

            pushd "notebook/Public Examples" ; git log "${notebook:?}" ; popd

    >   commit 851d9c76436dfc5bcbe56f15ba74e4414333dd5d (HEAD -> main)
    >   Author: aglais-admin <aglais-admin@dm92.uk>
    >   Date:   Wed Mar 30 03:14:06 2022 +0000
    >   
    >       Save latest
    >   
    >   commit 18682e7496b1442316c1447bd6b24e7fb37471fe
    >   Author: fedora <fedora@zeppelin>
    >   Date:   Tue Mar 15 15:12:41 2022 +0000
    >   
    >       Clear cache



            notebook='6. Working with cross-matched surveys_2GZME59KY.zpln'
            diff "notebook/Public Examples/${notebook:?}" \
                 "notebook-bak-002/Public Examples/${notebook:?}"

    >   ....
    >   ....
    >   396c384,386
    >   <     "isZeppelinNotebookCronEnable": false
    >   ---
    >   >     "isZeppelinNotebookCronEnable": false,
    >   >     "looknfeel": "default",
    >   >     "personalizedMode": "false"
    >   398c388,389
    >   <   "info": {}
    >   ---
    >   >   "info": {},
    >   >   "path": "/Public Examples/6. Working with cross-matched surveys"


            pushd "notebook/Public Examples" ; git log "${notebook:?}" ; popd

    >   Author: aglais-admin <aglais-admin@dm92.uk>
    >   Date:   Wed Mar 30 03:16:53 2022 +0000
    >   
    >       Save latest
    >   
    >   commit 0550046fa2cf3878ab1b6606031a5d214dc6eaa4
    >   Author: aglais-admin <aglais-admin@dm92.uk>
    >   Date:   Tue Mar 29 12:53:23 2022 +0000
    >   
    >       Added changes to Public Examples
    >   
    >   commit c5e154ba2e8ee8abc995cd30cea06d12b70f9870
    >   ....
    >   ....



            notebook='4. Mean proper motions over the sky_2GSNYBDWB.zpln'
            diff "notebook/Public Examples/${notebook:?}" \
                 "notebook-bak-002/Public Examples/${notebook:?}"

    >   ....
    >   ....
    >   376c385,389
    >   <   "info": {}
    >   ---
    >   >   "info": {},
    >   >   "path": "/Public Examples/4. Mean proper motions over the sky",
    >   >   "checkpoint": {
    >   >     "message": "Intro"
    >   >   }


            pushd "notebook/Public Examples" ; git log "${notebook:?}" ; popd

    >   Author: aglais-admin <aglais-admin@dm92.uk>
    >   Date:   Wed Mar 30 03:18:33 2022 +0000
    >   
    >       Save latest
    >   
    >   commit 0550046fa2cf3878ab1b6606031a5d214dc6eaa4
    >   Author: aglais-admin <aglais-admin@dm92.uk>
    >   Date:   Tue Mar 29 12:53:23 2022 +0000
    >   
    >       Added changes to Public Examples
    >   
    >   commit 52a3daec6c54e579639f52a3eacc4dae07b50a21
    >   ....



            notebook='3. Source counts over the sky_2GQ6WMH9W.zpln'
            diff "notebook/Public Examples/${notebook:?}" \
                 "notebook-bak-002/Public Examples/${notebook:?}"

    >   ....
    >   ....
    >   223a212,215
    >   >   },
    >   >   "path": "/Public Examples/3. Source counts over the sky",
    >   >   "checkpoint": {
    >   >     "message": "Removed last 2 paras"


            pushd "notebook/Public Examples" ; git log "${notebook:?}" ; popd

    >   Author: aglais-admin <aglais-admin@dm92.uk>
    >   Date:   Wed Mar 30 03:21:52 2022 +0000
    >   
    >       Save latest
    >   
    >   commit f9eb43ec4755df71a795336bf5d80f88d932bcec
    >   Author: fedora <fedora@zeppelin>
    >   Date:   Tue Mar 15 12:34:26 2022 +0000
    >   
    >       Removed last 2 paras



            notebook='2. Data holdings_2GRA39HCN.zpln'
            diff "notebook/Public Examples/${notebook:?}" \
                 "notebook-bak-002/Public Examples/${notebook:?}"

    >   ....
    >   ....
    >   345c354,355
    >   <   "info": {}
    >   ---
    >   >   "info": {},
    >   >   "path": "/Public Examples/2. Data holdings"


            pushd "notebook/Public Examples" ; git log "${notebook:?}" ; popd

    >   Author: aglais-admin <aglais-admin@dm92.uk>
    >   Date:   Wed Mar 30 03:24:09 2022 +0000
    >   
    >       Save latest
    >   
    >   commit 0550046fa2cf3878ab1b6606031a5d214dc6eaa4
    >   Author: aglais-admin <aglais-admin@dm92.uk>
    >   Date:   Tue Mar 29 12:53:23 2022 +0000
    >   
    >       Added changes to Public Examples



            notebook='1. Start here_2GRTQZFUM.zpln'
            diff "notebook/Public Examples/${notebook:?}" \
                 "notebook-bak-002/Public Examples/${notebook:?}"

    >   ....
    >   ....
    >   355c363,364
    >   <   "info": {}
    >   ---
    >   >   "info": {},
    >   >   "path": "/Public Examples/1. Start here"


            pushd "notebook/Public Examples" ; git log "${notebook:?}" ; popd

    >   Author: aglais-admin <aglais-admin@dm92.uk>
    >   Date:   Wed Mar 30 03:25:33 2022 +0000
    >   
    >       Save latest
    >   
    >   commit 123bdde81c4dcb08bb1162837a1b43568bad7084
    >   Author: NigelHambly <nch@roe.ac.uk>
    >   Date:   Wed Mar 9 15:11:36 2022 +0000
    >   
    >       Renamed and tweaked


# -----------------------------------------------------
# -----------------------------------------------------


    So the notebooks in the local git now match the notebooks in Zeppelin.
    Now we need to transfer this state to GitHub.

    cp -a notebook notebook-bak-003

    pushd notebook-bak-003

        git status

    >   On branch main
    >   Your branch and 'origin/main' have diverged,
    >   and have 24 and 8 different commits each, respectively.
    >     (use "git pull" to merge the remote branch into yours)


        # Pull, preferring our changes.
        # https://stackoverflow.com/a/68580000
        # https://stackoverflow.com/questions/10414769/git-pull-keeping-local-changes

        git pull -X ours

    >   Auto-merging Public Examples/9. Tips and tricks_2GVXKC266.zpln
    >   CONFLICT (rename/delete): Public Examples/Good astrometric solutions via ML Random Forrest classifier_2GQDKZ59J.zpln deleted in HEAD and renamed to Public Examples/7. Good astrometric solutions via ML Random Forrest classifier_2GQDKZ59J.zpln in b4817de52ebb7ac81e301a8a8464870692d23a24. Version b4817de52ebb7ac81e301a8a8464870692d23a24 of Public Examples/7. Good astrometric solutions via ML Random Forrest classifier_2GQDKZ59J.zpln left in tree.
    >   Auto-merging Public Examples/6. Working with cross-matched surveys_2GZME59KY.zpln
    >   CONFLICT (rename/delete): Public Examples/Mean proper motions over the sky_2GSNYBDWB.zpln deleted in HEAD and renamed to Public Examples/4. Mean proper motions over the sky_2GSNYBDWB.zpln in b4817de52ebb7ac81e301a8a8464870692d23a24. Version b4817de52ebb7ac81e301a8a8464870692d23a24 of Public Examples/4. Mean proper motions over the sky_2GSNYBDWB.zpln left in tree.
    >   CONFLICT (rename/delete): Public Examples/Source counts over the sky_2GQ6WMH9W.zpln deleted in HEAD and renamed to Public Examples/3. Source counts over the sky_2GQ6WMH9W.zpln in b4817de52ebb7ac81e301a8a8464870692d23a24. Version b4817de52ebb7ac81e301a8a8464870692d23a24 of Public Examples/3. Source counts over the sky_2GQ6WMH9W.zpln left in tree.
    >   CONFLICT (rename/delete): Public Examples/Data holdings_2GRA39HCN.zpln deleted in HEAD and renamed to Public Examples/2. Data holdings_2GRA39HCN.zpln in b4817de52ebb7ac81e301a8a8464870692d23a24. Version b4817de52ebb7ac81e301a8a8464870692d23a24 of Public Examples/2. Data holdings_2GRA39HCN.zpln left in tree.
    >   Automatic merge failed; fix conflicts and then commit the result.


        git mergetool

    >   This message is displayed because 'merge.tool' is not configured.
    >   See 'git mergetool --tool-help' or 'git help config' for more details.
    >   'git mergetool' will now attempt to use one of the following tools:
    >   tortoisemerge emerge vimdiff
    >   No known merge tool is available.
    >   Merging:
    >   Public Examples/2. Data holdings_2GRA39HCN.zpln
    >   Public Examples/3. Source counts over the sky_2GQ6WMH9W.zpln
    >   Public Examples/4. Mean proper motions over the sky_2GSNYBDWB.zpln
    >   Public Examples/7. Good astrometric solutions via ML Random Forrest classifier_2GQDKZ59J.zpln
    >   
    >   Deleted merge conflict for 'Public Examples/2. Data holdings_2GRA39HCN.zpln':
    >     {local}: deleted
    >     {remote}: created file
    >   Use (c)reated or (d)eleted file, or (a)bort? d
    >   
    >   Deleted merge conflict for 'Public Examples/3. Source counts over the sky_2GQ6WMH9W.zpln':
    >     {local}: deleted
    >     {remote}: created file
    >   Use (c)reated or (d)eleted file, or (a)bort? d
    >   
    >   Deleted merge conflict for 'Public Examples/4. Mean proper motions over the sky_2GSNYBDWB.zpln':
    >     {local}: deleted
    >     {remote}: created file
    >   Use (c)reated or (d)eleted file, or (a)bort? d
    >   
    >   Deleted merge conflict for 'Public Examples/7. Good astrometric solutions via ML Random Forrest classifier_2GQDKZ59J.zpln':
    >     {local}: deleted
    >     {remote}: created file
    >   Use (c)reated or (d)eleted file, or (a)bort? d

        popd

    notebook='1. Start here_2GRTQZFUM.zpln'
    diff "notebook/Public Examples/${notebook:?}" \
         "notebook-bak-003/Public Examples/${notebook:?}"

    >   -

    notebook='2. Data holdings_2GRA39HCN.zpln'
    diff "notebook/Public Examples/${notebook:?}" \
         "notebook-bak-003/Public Examples/${notebook:?}"

    >   diff: notebook-bak-003/Public Examples/2. Data holdings_2GRA39HCN.zpln: No such file or directory

    #
    # So selecting '{local}: deleted' deletes the file, even though we didn't delete the local file.
    # How do we choose the local file ?
    #




# -----------------------------------------------------
# -----------------------------------------------------


    Try that again ...

    cp -a notebook notebook-bak-004

    pushd notebook-bak-004

        git status

    >   On branch main
    >   Your branch and 'origin/main' have diverged,
    >   and have 24 and 8 different commits each, respectively.
    >     (use "git pull" to merge the remote branch into yours)


        # Pull, preferring our changes.
        # https://stackoverflow.com/a/68580000
        # https://stackoverflow.com/questions/10414769/git-pull-keeping-local-changes

        git pull -X ours


    >   Auto-merging Public Examples/9. Tips and tricks_2GVXKC266.zpln
    >   CONFLICT (rename/delete): Public Examples/Good astrometric solutions via ML Random Forrest classifier_2GQDKZ59J.zpln deleted in HEAD and renamed to Public Examples/7. Good astrometric solutions via ML Random Forrest classifier_2GQDKZ59J.zpln in b4817de52ebb7ac81e301a8a8464870692d23a24. Version b4817de52ebb7ac81e301a8a8464870692d23a24 of Public Examples/7. Good astrometric solutions via ML Random Forrest classifier_2GQDKZ59J.zpln left in tree.
    >   Auto-merging Public Examples/6. Working with cross-matched surveys_2GZME59KY.zpln
    >   CONFLICT (rename/delete): Public Examples/Mean proper motions over the sky_2GSNYBDWB.zpln deleted in HEAD and renamed to Public Examples/4. Mean proper motions over the sky_2GSNYBDWB.zpln in b4817de52ebb7ac81e301a8a8464870692d23a24. Version b4817de52ebb7ac81e301a8a8464870692d23a24 of Public Examples/4. Mean proper motions over the sky_2GSNYBDWB.zpln left in tree.
    >   CONFLICT (rename/delete): Public Examples/Source counts over the sky_2GQ6WMH9W.zpln deleted in HEAD and renamed to Public Examples/3. Source counts over the sky_2GQ6WMH9W.zpln in b4817de52ebb7ac81e301a8a8464870692d23a24. Version b4817de52ebb7ac81e301a8a8464870692d23a24 of Public Examples/3. Source counts over the sky_2GQ6WMH9W.zpln left in tree.
    >   CONFLICT (rename/delete): Public Examples/Data holdings_2GRA39HCN.zpln deleted in HEAD and renamed to Public Examples/2. Data holdings_2GRA39HCN.zpln in b4817de52ebb7ac81e301a8a8464870692d23a24. Version b4817de52ebb7ac81e301a8a8464870692d23a24 of Public Examples/2. Data holdings_2GRA39HCN.zpln left in tree.
    >   Automatic merge failed; fix conflicts and then commit the result.


        git status

    >   On branch main
    >   Your branch and 'origin/main' have diverged,
    >   and have 24 and 8 different commits each, respectively.
    >     (use "git pull" to merge the remote branch into yours)
    >   
    >   You have unmerged paths.
    >     (fix conflicts and run "git commit")
    >     (use "git merge --abort" to abort the merge)
    >   
    >   Changes to be committed:
    >   	modified:   Public Examples/6. Working with cross-matched surveys_2GZME59KY.zpln
    >   
    >   Unmerged paths:
    >     (use "git add <file>..." to mark resolution)
    >   	added by them:   Public Examples/2. Data holdings_2GRA39HCN.zpln
    >   	added by them:   Public Examples/3. Source counts over the sky_2GQ6WMH9W.zpln
    >   	added by them:   Public Examples/4. Mean proper motions over the sky_2GSNYBDWB.zpln
    >   	added by them:   Public Examples/7. Good astrometric solutions via ML Random Forrest classifier_2GQDKZ59J.zpln


        tail 'Public Examples/2. Data holdings_2GRA39HCN.zpln'

    >   ....
    >   ....
    >     "noteForms": {},
    >     "angularObjects": {},
    >     "config": {
    >       "isZeppelinNotebookCronEnable": false,
    >       "looknfeel": "default",
    >       "personalizedMode": "false"
    >     },
    >     "info": {},
    >     "path": "/Public Examples/2. Data holdings"
    >   }


        git log 'Public Examples/2. Data holdings_2GRA39HCN.zpln'

    >   commit fce5868c43f7884a4418355a43ab751dc36e6792
    >   Author: aglais-admin <aglais-admin@dm92.uk>
    >   Date:   Wed Mar 30 03:24:09 2022 +0000
    >   
    >       Save latest
    >   
    >   commit 0550046fa2cf3878ab1b6606031a5d214dc6eaa4
    >   Author: aglais-admin <aglais-admin@dm92.uk>
    >   Date:   Tue Mar 29 12:53:23 2022 +0000
    >   
    >       Added changes to Public Examples
    >   ....
    >   ....

        # Try adding the file ?
        git add 'Public Examples/2. Data holdings_2GRA39HCN.zpln'


        git log 'Public Examples/2. Data holdings_2GRA39HCN.zpln'

    >   commit fce5868c43f7884a4418355a43ab751dc36e6792
    >   Author: aglais-admin <aglais-admin@dm92.uk>
    >   Date:   Wed Mar 30 03:24:09 2022 +0000
    >   
    >       Save latest
    >   
    >   commit 0550046fa2cf3878ab1b6606031a5d214dc6eaa4
    >   Author: aglais-admin <aglais-admin@dm92.uk>
    >   Date:   Tue Mar 29 12:53:23 2022 +0000
    >   
    >       Added changes to Public Examples


        tail 'Public Examples/2. Data holdings_2GRA39HCN.zpln'

    >     "noteForms": {},
    >     "angularObjects": {},
    >     "config": {
    >       "isZeppelinNotebookCronEnable": false,
    >       "looknfeel": "default",
    >       "personalizedMode": "false"
    >     },
    >     "info": {},
    >     "path": "/Public Examples/2. Data holdings"
    >   }

        pushd ..
            notebook='2. Data holdings_2GRA39HCN.zpln'
            diff "notebook/Public Examples/${notebook:?}" \
                 "notebook-bak-004/Public Examples/${notebook:?}"
        popd


    >   ....
    >   ....
    >   303c311
    >   <       "text": "%md\n\n",
    >   ---
    >   >       "text": "%md\n",
    >   305c313
    >   <       "dateUpdated": "2022-03-30 03:24:02.893",
    >   ---
    >   >       "dateUpdated": "2021-12-12T21:50:58+0000",
    >   308,309c316,317
    >   <         "colWidth": 12.0,
    >   <         "fontSize": 9.0,
    >   ---
    >   >         "colWidth": 12,
    >   >         "fontSize": 9,
    >   329,330c337,339
    >   <       "dateCreated": "2021-12-12 21:50:58.000",
    >   <       "status": "READY"
    >   ---
    >   >       "dateCreated": "2021-12-12T21:50:58+0000",
    >   >       "status": "READY",
    >   >       "$$hashKey": "object:38647"
    >   345c354,355
    >   <   "info": {}
    >   ---
    >   >   "info": {},
    >   >   "path": "/Public Examples/2. Data holdings"

    #
    # This has reverted notebook 2. to the remote version.
    #

    git status

    >   On branch main
    >   Your branch and 'origin/main' have diverged,
    >   and have 24 and 8 different commits each, respectively.
    >     (use "git pull" to merge the remote branch into yours)
    >   
    >   You have unmerged paths.
    >     (fix conflicts and run "git commit")
    >     (use "git merge --abort" to abort the merge)
    >   
    >   Changes to be committed:
    >   	modified:   Public Examples/2. Data holdings_2GRA39HCN.zpln
    >   	modified:   Public Examples/6. Working with cross-matched surveys_2GZME59KY.zpln
    >   
    >   Unmerged paths:
    >     (use "git add <file>..." to mark resolution)
    >   	added by them:   Public Examples/3. Source counts over the sky_2GQ6WMH9W.zpln
    >   	added by them:   Public Examples/4. Mean proper motions over the sky_2GSNYBDWB.zpln
    >   	added by them:   Public Examples/7. Good astrometric solutions via ML Random Forrest classifier_2GQDKZ59J.zpln


        # Check the current state of notebook 3.
        pushd ..
            notebook='3. Source counts over the sky_2GQ6WMH9W.zpln'
            diff "notebook/Public Examples/${notebook:?}" \
                 "notebook-bak-004/Public Examples/${notebook:?}"
        popd

    >   ....
    >   .... Lots of difference
    >   ....

        # Try the rm oprion ?
        git rm "Public Examples/${notebook:?}"

        # So now the file is gone ...
        git log "Public Examples/${notebook:?}"

    >   fatal: ambiguous argument 'Public Examples/3. Source counts over the sky_2GQ6WMH9W.zpln': unknown revision or path not in the working tree.
    >   Use '--' to separate paths from revisions, like this:
    >   'git <command> [<revision>...] -- [<file>...]'


        # This is becomming a waste of time.
        # We don't need thge history anyway.
        # The records of who did what are all mangled.
        # The JSON mangling of multip-line text obscures the details of any changes.
        # Nuke the lot and start from fresh.

        # Use the current state to initialise a new git repository.


# -----------------------------------------------------
# Save the current state.
#[user@desktop]

    source "${HOME:?}/aglais.env"
    pushd "${AGLAIS_HOME}"
        pushd backups

            scp -r zeppelin:zeppelin/notebook notebook-$(date '+%Y%m%d')

    >   1. Start here_2GRTQZFUM.zpln                                                                                                             100%   69KB   1.9MB/s   00:00
    >   3. Source counts over the sky_2GQ6WMH9W.zpln                                                                                             100%  603KB   6.7MB/s   00:00
    >   7. Good astrometric solutions via ML Random Forrest classifier_2GQDKZ59J.zpln                                                            100%  804KB   8.2MB/s   00:00
    >   9. Tips and tricks_2GVXKC266.zpln                                                                                                        100%  300KB   7.7MB/s   00:00
    >   ....
    >   ....
    >   PYXJTCNBHR.json_2GZD8REWD.zpln                                                                                                           100%  200KB   6.9MB/s   00:00
    >   K15QY1RZO3.json_2GW6RBS2D.zpln                                                                                                           100%   12KB 673.8KB/s   00:00
    >   LICENSE                                                                                                                                  100%   34KB   1.7MB/s   00:00
    >   README.md                                                                                                                                100%  145     8.2KB/s   00:00

            du -h -d 1 notebook-$(date '+%Y%m%d')

    >   3.2M    notebook-20220330/Public Examples
    >   31M     notebook-20220330/Users
    >   99M     notebook-20220330/.git
    >   14M     notebook-20220330/tmp
    >   145M    notebook-20220330


            du -h -d 2 notebook-$(date '+%Y%m%d')

    >   3.2M    notebook-20220330/Public Examples
    >   12K     notebook-20220330/Users/zrq
    >   27M     notebook-20220330/Users/dcr
    >   3.7M    notebook-20220330/Users/nch
    >   31M     notebook-20220330/Users
    >   98M     notebook-20220330/.git/objects
    >   20K     notebook-20220330/.git/refs
    >   0       notebook-20220330/.git/branches
    >   32K     notebook-20220330/.git/logs
    >   4.0K    notebook-20220330/.git/info
    >   32K     notebook-20220330/.git/hooks
    >   99M     notebook-20220330/.git
    >   14M     notebook-20220330/tmp
    >   145M    notebook-20220330

    #
    # If we delete .git and /tmp we get the latest version of all the notebooks.
    # Use that as the starting place for the next implementation.
    #

    #
    # Create the bare repo and push into it using option 2b from this StackOver post.
    # https://stackoverflow.com/a/31590993
    #






